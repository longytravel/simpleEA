=== Trade Request Structure (Pages 958-970) ===

--- Page 958 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
958
The Trade Request Structure (MqlTradeRequest)
Interaction between the client terminal and a trade server for executing the order placing operation is
performed by using trade requests. The trade request is represented by the special predefined
structure of MqlTradeRequest type, which contain all the fields necessary to perform trade deals. The
request processing result is represented by the structure of MqlTradeResult type.
struct MqlTradeRequest
  {
   ENUM_TRADE_REQUEST_ACTIONS    action;           // Trade operation type
   ulong                         magic;            // Expert Advisor ID (magic number)
   ulong                         order;            // Order ticket
   string                        symbol;           // Trade symbol
   double                        volume;           // Requested volume for a deal in l
   double                        price;            // Price
   double                        stoplimit;        // StopLimit level of the order
   double                        sl;               // Stop Loss level of the order
   double                        tp;               // Take Profit level of the order
   ulong                         deviation;        // Maximal possible deviation from 
   ENUM_ORDER_TYPE               type;             // Order type
   ENUM_ORDER_TYPE_FILLING       type_filling;     // Order execution type
   ENUM_ORDER_TYPE_TIME          type_time;        // Order expiration type
   datetime                      expiration;       // Order expiration time (for the o
   string                        comment;          // Order comment
   ulong                         position;         // Position ticket
   ulong                         position_by;      // The ticket of an opposite positi
  };
Fields description
Field
Description
action
Trade operation type. Can be one of the ENUM_TRADE_REQUEST_ACTIONS
enumeration values.
magic
Expert Advisor ID. It allows organizing analytical processing of trade orders. Each
Expert Advisor can set its own unique ID when sending a trade request.
order
Order ticket. It is used for modifying pending orders.
symbol
Symbol of the order. It is not necessary for order modification and position close
operations.
volume
Requested order volume in lots. Note that the real volume of a deal will depend on
the order execution type.
price
Price, reaching which the order must be executed. Market orders of symbols,
whose 
execution 
type 
is 
"Market
Execution" (SYMBOL_TRADE_EXECUTION_MARKET), of TRADE_ACTION_DEAL type,
do not require specification of price.


--- Page 959 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
959
Field
Description
stoplimit
The price value, at which the Limit pending order will be placed, when price
reaches the price value (this condition is obligatory). Until then the pending order
is not placed. 
sl
Stop Loss price in case of the unfavorable price movement
tp
Take Profit price in the case of the favorable price movement
deviation
The maximal price deviation, specified in points
type
Order type. Can be one of the ENUM_ORDER_TYPE enumeration values.
type_filling
Order 
execution 
type. 
Can 
be 
one 
of 
the 
enumeration
ENUM_ORDER_TYPE_FILLING values.
type_time
Order expiration type. Can be one of the enumeration ENUM_ORDER_TYPE_TIME
values.
expiration
Order expiration time (for orders of ORDER_TIME_SPECIFIED type)
comment
Order comment
position
Ticket of a position. Should be filled in when a position is modified or closed to
identify the position. As a rule it is equal to the ticket of the order, based on
which the position was opened.
position_by
Ticket of an opposite position. Used when a position is closed by an opposite one
open for the same symbol in the opposite direction.
When modifying or closing a position in the hedging system, make sure to specify its ticket
(MqlTradeRequest::position). The ticket can also be specified in the netting system, though a
position is identified by the symbol name.
For sending orders to perform trade operations it is necessary to use the OrderSend() function. For
each trade operation it is necessary to specify obligatory fields; optional fields also may be filled.
There are seven possible cases to send a trade order:
Request Execution
This is a trade order to open a position in the Request Execution mode (trade upon requested
prices). It requires to specify the following 9 fields:
· action
· symbol
· volume
· price
· sl
· tp
· deviation
· type
· type_filling
Also it is possible to specify the "magic" and "comment" field values.


--- Page 960 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
960
Instant Execution
This is a trade order to open a position in the Instant Execution mode (trade by current prices). It
requires specification of the following 9 fields:
· action
· symbol
· volume
· price
· sl
· tp
· deviation
· type
· type_filling
Also it is possible to specify the "magic" and "comment" field values.
Market Execution
This is a trade order to open a position in the Market Execution mode. It requires to specify the
following 5 fields:
· action
· symbol
· volume
· type
· type_filling
Also it is possible to specify the "magic" and "comment" field values.
Exchange Execution
This is a trade order to open a position in the Exchange Execution mode. It requires to specify the
following 5 fields:
· action
· symbol
· volume
· type
· type_filling
Also it is possible to specify the "magic" and "comment" field values.
Example of the TRADE_ACTION_DEAL trade operation for opening a Buy position:


--- Page 961 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
961
#define EXPERT_MAGIC 123456   // MagicNumber of the expert
//+------------------------------------------------------------------+
//| Opening Buy position                                             |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declare and initialize the trade request and result of trade request
   MqlTradeRequest request={};
   MqlTradeResult  result={};
//--- parameters of request
   request.action   =TRADE_ACTION_DEAL;                     // type of trade operation
   request.symbol   =Symbol();                              // symbol
   request.volume   =0.1;                                   // volume of 0.1 lot
   request.type     =ORDER_TYPE_BUY;                        // order type
   request.price    =SymbolInfoDouble(Symbol(),SYMBOL_ASK); // price for opening
   request.deviation=5;                                     // allowed deviation from 
   request.magic    =EXPERT_MAGIC;                          // MagicNumber of the orde
//--- send the request
   if(!OrderSend(request,result))
      PrintFormat("OrderSend error %d",GetLastError());     // if unable to send the r
//--- information about the operation
   PrintFormat("retcode=%u  deal=%I64u  order=%I64u",result.retcode,result.deal,result
  }
//+------------------------------------------------------------------+
Example of the TRADE_ACTION_DEAL trade operation for opening a Sell position:
#define EXPERT_MAGIC 123456   // MagicNumber of the expert
//+------------------------------------------------------------------+
//| Opening Sell position                                            |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declare and initialize the trade request and result of trade request
   MqlTradeRequest request={};
   MqlTradeResult  result={};
//--- parameters of request
   request.action   =TRADE_ACTION_DEAL;                     // type of trade operation
   request.symbol   =Symbol();                              // symbol
   request.volume   =0.2;                                   // volume of 0.2 lot
   request.type     =ORDER_TYPE_SELL;                       // order type
   request.price    =SymbolInfoDouble(Symbol(),SYMBOL_BID); // price for opening
   request.deviation=5;                                     // allowed deviation from 
   request.magic    =EXPERT_MAGIC;                          // MagicNumber of the orde
//--- send the request
   if(!OrderSend(request,result))
      PrintFormat("OrderSend error %d",GetLastError());     // if unable to send the r
//--- information about the operation
   PrintFormat("retcode=%u  deal=%I64u  order=%I64u",result.retcode,result.deal,result
  }
//+------------------------------------------------------------------+
Example of the TRADE_ACTION_DEAL trade operation for closing positions:


--- Page 962 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
962
#define EXPERT_MAGIC 123456   // MagicNumber of the expert
//+------------------------------------------------------------------+
//| Closing all positions                                            |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declare and initialize the trade request and result of trade request
   MqlTradeRequest request;
   MqlTradeResult  result;
   int total=PositionsTotal(); // number of open positions   
//--- iterate over all open positions
   for(int i=total-1; i>=0; i--)
     {
      //--- parameters of the order
      ulong  position_ticket=PositionGetTicket(i);                                    
      string position_symbol=PositionGetString(POSITION_SYMBOL);                      
      int    digits=(int)SymbolInfoInteger(position_symbol,SYMBOL_DIGITS);            
      ulong  magic=PositionGetInteger(POSITION_MAGIC);                                
      double volume=PositionGetDouble(POSITION_VOLUME);                               
      ENUM_POSITION_TYPE type=(ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  
      //--- output information about the position
      PrintFormat("#%I64u %s  %s  %.2f  %s [%I64d]",
                  position_ticket,
                  position_symbol,
                  EnumToString(type),
                  volume,
                  DoubleToString(PositionGetDouble(POSITION_PRICE_OPEN),digits),
                  magic);
      //--- if the MagicNumber matches
      if(magic==EXPERT_MAGIC)
        {
         //--- zeroing the request and result values
         ZeroMemory(request);
         ZeroMemory(result);
         //--- setting the operation parameters
         request.action   =TRADE_ACTION_DEAL;        // type of trade operation
         request.position =position_ticket;          // ticket of the position
         request.symbol   =position_symbol;          // symbol 
         request.volume   =volume;                   // volume of the position
         request.deviation=5;                        // allowed deviation from the pri
         request.magic    =EXPERT_MAGIC;             // MagicNumber of the position
         //--- set the price and order type depending on the position type
         if(type==POSITION_TYPE_BUY)
           {
            request.price=SymbolInfoDouble(position_symbol,SYMBOL_BID);
            request.type =ORDER_TYPE_SELL;
           }
         else
           {
            request.price=SymbolInfoDouble(position_symbol,SYMBOL_ASK);
            request.type =ORDER_TYPE_BUY;
           }
         //--- output information about the closure
         PrintFormat("Close #%I64d %s %s",position_ticket,position_symbol,EnumToString
         //--- send the request
         if(!OrderSend(request,result))
            PrintFormat("OrderSend error %d",GetLastError());  // if unable to send th
         //--- information about the operation   
         PrintFormat("retcode=%u  deal=%I64u  order=%I64u",result.retcode,result.deal,
         //---
        }


--- Page 963 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
963
     }
  }
//+------------------------------------------------------------------+
SL & TP Modification
Trade order to modify the StopLoss and/or TakeProfit price levels. It requires to specify the
following 4 fields:
· action
· symbol
· sl
· tp
· position
Example of the TRADE_ACTION_SLTP trade operation for modifying the Stop Loss and Take Profit
values of an open position:
#define EXPERT_MAGIC 123456  // MagicNumber of the expert
//+------------------------------------------------------------------+
//| Modification of Stop Loss and Take Profit of position            |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declare and initialize the trade request and result of trade request
   MqlTradeRequest request;
   MqlTradeResult  result;
   int total=PositionsTotal(); // number of open positions   
//--- iterate over all open positions
   for(int i=0; i<total; i++)
     {
      //--- parameters of the order
      ulong  position_ticket=PositionGetTicket(i);// ticket of the position
      string position_symbol=PositionGetString(POSITION_SYMBOL); // symbol 
      int    digits=(int)SymbolInfoInteger(position_symbol,SYMBOL_DIGITS); // number o
      ulong  magic=PositionGetInteger(POSITION_MAGIC); // MagicNumber of the position
      double volume=PositionGetDouble(POSITION_VOLUME);    // volume of the position
      double sl=PositionGetDouble(POSITION_SL);  // Stop Loss of the position
      double tp=PositionGetDouble(POSITION_TP);  // Take Profit of the position
      ENUM_POSITION_TYPE type=(ENUM_POSITION_TYPE)PositionGetInteger(POSITION_TYPE);  
      //--- output information about the position
      PrintFormat("#%I64u %s  %s  %.2f  %s  sl: %s  tp: %s  [%I64d]",
                  position_ticket,
                  position_symbol,
                  EnumToString(type),
                  volume,
                  DoubleToString(PositionGetDouble(POSITION_PRICE_OPEN),digits),
                  DoubleToString(sl,digits),
                  DoubleToString(tp,digits),
                  magic);
      //--- if the MagicNumber matches, Stop Loss and Take Profit are not defined
      if(magic==EXPERT_MAGIC && sl==0 && tp==0)
        {


--- Page 964 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
964
         //--- calculate the current price levels
         double price=PositionGetDouble(POSITION_PRICE_OPEN);
         double bid=SymbolInfoDouble(position_symbol,SYMBOL_BID);
         double ask=SymbolInfoDouble(position_symbol,SYMBOL_ASK);
         int    stop_level=(int)SymbolInfoInteger(position_symbol,SYMBOL_TRADE_STOPS_L
         double price_level;
         //--- if the minimum allowed offset distance in points from the current close
         if(stop_level<=0)
            stop_level=150; // set the offset distance of 150 points from the current 
         else
            stop_level+=50; // set the offset distance to (SYMBOL_TRADE_STOPS_LEVEL + 
         //--- calculation and rounding of the Stop Loss and Take Profit values
         price_level=stop_level*SymbolInfoDouble(position_symbol,SYMBOL_POINT);
         if(type==POSITION_TYPE_BUY)
           {
            sl=NormalizeDouble(bid-price_level,digits);
            tp=NormalizeDouble(bid+price_level,digits);
           }
         else
           {
            sl=NormalizeDouble(ask+price_level,digits);
            tp=NormalizeDouble(ask-price_level,digits);
           }
         //--- zeroing the request and result values
         ZeroMemory(request);
         ZeroMemory(result);
         //--- setting the operation parameters
         request.action  =TRADE_ACTION_SLTP; // type of trade operation
         request.position=position_ticket;   // ticket of the position
         request.symbol=position_symbol;     // symbol 
         request.sl      =sl;                // Stop Loss of the position
         request.tp      =tp;                // Take Profit of the position
         request.magic=EXPERT_MAGIC;         // MagicNumber of the position
         //--- output information about the modification
         PrintFormat("Modify #%I64d %s %s",position_ticket,position_symbol,EnumToStrin
         //--- send the request
         if(!OrderSend(request,result))
            PrintFormat("OrderSend error %d",GetLastError());  // if unable to send th
         //--- information about the operation   
         PrintFormat("retcode=%u  deal=%I64u  order=%I64u",result.retcode,result.deal,
        }
     }
  }
//+------------------------------------------------------------------+
Pending Order
Trade order to place a pending order. It requires to specify the following 11 fields:
· action
· symbol
· volume
· price
· stoplimit
· sl
· tp
· type


--- Page 965 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
965
· type_filling
· type_time
· expiration
Also it is possible to specify the "magic" and "comment" field values.
Example of the TRADE_ACTION_PENDING trade operation for placing a pending order:


--- Page 966 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
966
#property description "Example of placing pending orders"
#property script_show_inputs
#define EXPERT_MAGIC 123456                             // MagicNumber of the expert
input ENUM_ORDER_TYPE orderType=ORDER_TYPE_BUY_LIMIT;   // order type
//+------------------------------------------------------------------+
//| Placing pending orders                                           |
//+------------------------------------------------------------------+
void OnStart()
  {
//--- declare and initialize the trade request and result of trade request
   MqlTradeRequest request={};
   MqlTradeResult  result={};
//--- parameters to place a pending order
   request.action   =TRADE_ACTION_PENDING;                             // type of trad
   request.symbol   =Symbol();                                         // symbol
   request.volume   =0.1;                                              // volume of 0.
   request.deviation=2;                                                // allowed devi
   request.magic    =EXPERT_MAGIC;                                     // MagicNumber 
   int offset = 50;                                                    // offset from 
   double price;                                                       // order trigge
   double point=SymbolInfoDouble(_Symbol,SYMBOL_POINT);                // value of poi
   int digits=SymbolInfoInteger(_Symbol,SYMBOL_DIGITS);                // number of de
   //--- checking the type of operation
   if(orderType==ORDER_TYPE_BUY_LIMIT)
     {
      request.type     =ORDER_TYPE_BUY_LIMIT;                          // order type
      price=SymbolInfoDouble(Symbol(),SYMBOL_ASK)-offset*point;        // price for op
      request.price    =NormalizeDouble(price,digits);                 // normalized o
     }
   else if(orderType==ORDER_TYPE_SELL_LIMIT)
     {
      request.type     =ORDER_TYPE_SELL_LIMIT;                          // order type
      price=SymbolInfoDouble(Symbol(),SYMBOL_BID)+offset*point;         // price for o
      request.price    =NormalizeDouble(price,digits);                  // normalized 
     }
   else if(orderType==ORDER_TYPE_BUY_STOP)
     {
      request.type =ORDER_TYPE_BUY_STOP;                                // order type
      price        =SymbolInfoDouble(Symbol(),SYMBOL_ASK)+offset*point; // price for o
      request.price=NormalizeDouble(price,digits);                      // normalized 
     }
   else if(orderType==ORDER_TYPE_SELL_STOP)
     {
      request.type     =ORDER_TYPE_SELL_STOP;                           // order type
      price=SymbolInfoDouble(Symbol(),SYMBOL_BID)-offset*point;         // price for o
      request.price    =NormalizeDouble(price,digits);                  // normalized 
     }
   else Alert("This example is only for placing pending orders");   // if not pending 
//--- send the request
   if(!OrderSend(request,result))
      PrintFormat("OrderSend error %d",GetLastError());                 // if unable t
//--- information about the operation
   PrintFormat("retcode=%u  deal=%I64u  order=%I64u",result.retcode,result.deal,result
  }
//+------------------------------------------------------------------+
Modify Pending Order
Trade order to modify the prices of a pending order. It requires to specify the following 7 fields:
· action


--- Page 967 ---
Constants, Enumerations and Structures
© 2000-2025, MetaQuotes Ltd.
967
· order
· price
· sl
· tp
· type_time
· expiration
Example of the TRADE_ACTION_MODIFY trade operation for modifying the price levels of pending
orders:
